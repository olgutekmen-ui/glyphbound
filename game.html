<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Glyphbound: Protocol</title>
  
  <link rel="stylesheet" href="style.css?v=1.12" />
</head>
<body>
  <div id="game-root">
    
    <div id="top-hud">
      <div id="hud-main-row">
        <div id="level-indicator">LEVEL: --</div>
        <div id="time-indicator">TIME: --</div>
      </div>

      <div id="hud-sub-row">
        <span style="color:#facc15">âš¡ <span id="energy-count">--</span></span>
        <span style="color:#38bdf8; margin-left:8px;">ðŸ’Ž <span id="prisma-count">--</span></span>
        <span style="color:#f472b6; margin-left:8px;">ðŸª™ <span id="aurum-count">--</span></span>
      </div>

      <div id="disciple-hp-area">
        <div id="disciple-hp-label">-- HP</div>
        <div id="disciple-hp-bar-back"><div id="disciple-hp-bar"></div></div>
        <div style="font-size:0.65rem; color:#94a3b8; margin-top:2px;">GOAL: KILL</div>
      </div>
      
      <div style="text-align:center; font-size:0.9rem; margin-top:4px; color:#fff; font-weight:bold; letter-spacing:1px;">
        MOVES LEFT: <span id="moves-left" style="color:#38bdf8; font-size:1.1rem;">--</span>
      </div>
    </div>

    <div id="chibi-row">
      <div class="chibiFrame"><img id="hero-chibi-live" src="" alt="hero" /></div>
      <div class="chibiFrame">
          <img id="disciple-chibi-live" src="" alt="disciple" />
          <div id="disciple-badge-live" style="display:none;"></div>
      </div>
    </div>

    <div id="game-grid"></div>
    
    <div id="ability-bar" style="display:flex; justify-content:center; gap:10px; margin: 10px 0;">
       <div class="ability-slot">
         <div id="aelia-ability-ring" class="ability-ring"><img id="aelia-ability-icon" class="ability-icon" src="assets/tile_aelia.png" alt="A"/></div>
         <span class="ability-label">AELIA</span>
       </div>
       <div class="ability-slot">
         <div id="nocta-ability-ring" class="ability-ring"><img id="nocta-ability-icon" class="ability-icon" src="assets/tile_nocta.png" alt="N"/></div>
         <span class="ability-label">NOCTA</span>
       </div>
       <div class="ability-slot">
         <div id="vyra-ability-ring" class="ability-ring"><img id="vyra-ability-icon" class="ability-icon" src="assets/tile_vyra.png" alt="V"/></div>
         <span class="ability-label">VYRA</span>
       </div>
       <div class="ability-slot">
         <div id="iona-ability-ring" class="ability-ring"><img id="iona-ability-icon" class="ability-icon" src="assets/tile_iona.png" alt="I"/></div>
         <span class="ability-label">IONA</span>
       </div>
    </div>

    <div id="bottom-buttons">
      <button id="btn-map" class="bottom-btn">MAP</button>
      <button id="btn-restart" class="bottom-btn">RESTART</button>
      <button id="btn-shuffle" class="bottom-btn">SHUFFLE</button>
    </div>

    <div id="alert-banner"></div>

    <div id="end-overlay">
      <div id="end-box">
        <img id="end-chibi" src="" alt="result" />
        <div id="end-message" style="margin-bottom:1rem; font-weight:bold;"></div>
        
        <button id="btn-next-level" style="display:none; background:rgba(56,189,248,0.2); border-color:#38bdf8; margin-bottom:8px;">NEXT LEVEL</button>
        
        <button id="btn-play-again" onclick="safeReload()">PLAY AGAIN</button>
        <button onclick="window.location.href='map.html'">MAP</button>
        <button onclick="window.location.href='shop.html'" style="margin-top:5px; border-color:#f97316; color:#f97316;">SHOP</button>
      </div>
    </div>
  </div>

  <script src="globals.js?v=1.12"></script> 
  <script src="state.js?v=1.12"></script>
  <script src="fx.js?v=1.12"></script> 
  <script src="audio.js?v=1.12"></script> 
  <script src="levels.js?v=1.12"></script>
  <script src="economy.js?v=1.12"></script>
  <script src="items.js?v=1.12"></script> 
  <script src="ui.js?v=1.12"></script>  
  <script src="board.js?v=1.12"></script>
  <script src="abilities.js?v=1.12"></script>
  <script src="input.js?v=1.12"></script>
  <script src="engine.js?v=1.12"></script>
  <script src="boot.js?v=1.12"></script>
  
  <script>
      function safeReload() {
          if (window.economy && window.economy.spendEnergyForLevel()) {
              window.location.reload();
          } else {
              if(confirm("Not enough Energy! Go to Shop?")) window.location.href = "shop.html";
          }
      }
  </script>
</body>
</html>