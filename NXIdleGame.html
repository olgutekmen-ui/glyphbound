<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-X: Glyph Inventory (MVP)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for Cyberpunk feel */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        :root {
            --color-neon-blue: #00ffff;
            --color-neon-magenta: #ff00ff;
            --color-dark-bg: #100f1c;
            --color-accent-dark: #3a083a;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background-color: var(--color-dark-bg);
            color: white;
        }

        .neon-glow-blue {
            text-shadow: 0 0 5px var(--color-neon-blue), 0 0 10px var(--color-neon-blue);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
            border-color: var(--color-neon-blue);
        }

        .neon-glow-magenta {
            text-shadow: 0 0 5px var(--color-neon-magenta), 0 0 10px var(--color-neon-magenta);
            box-shadow: 0 0 8px rgba(255, 0, 255, 0.5);
            border-color: var(--color-neon-magenta);
        }

        .btn-base {
            transition: all 0.1s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        .btn-upgrade:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-lg bg-[#181525] p-6 md:p-8 rounded-xl border-4 border-gray-800 shadow-2xl">
        <h1 class="text-3xl md:text-4xl text-center mb-6 font-bold neon-glow-blue">GLYPH INVENTORY PROTOCOL</h1>
        <p class="text-center text-sm text-gray-400 mb-8">
            Purify corrupted materials leaking from the cracking Glyphs to produce Crafting Materials.
        </p>

        <!-- Resource Display -->
        <div class="space-y-3 mb-8">
            <div class="flex justify-between items-center p-3 rounded-lg border border-gray-700 bg-[#252233]">
                <span class="text-lg text-gray-300">Corrupted Materials (MCM)</span>
                <span id="mcm-display" class="text-2xl font-bold text-cyan-400 neon-glow-blue">0</span>
            </div>
            <div class="flex justify-between items-center p-3 rounded-lg border border-gray-700 bg-[#252233]">
                <span class="text-lg text-gray-300">Crafting Materials (CM)</span>
                <span id="cm-display" class="text-2xl font-bold text-fuchsia-400 neon-glow-magenta">0</span>
            </div>
        </div>

        <!-- Main Clicker Mechanic -->
        <div class="text-center mb-8">
            <button id="purify-btn" class="btn-base btn-primary w-full py-4 rounded-xl text-xl font-bold bg-cyan-600 text-white neon-glow-blue hover:bg-cyan-500 disabled:opacity-50" disabled>
                Tap to Purify (10s Boost)
            </button>
            <p id="purify-status" class="mt-2 text-sm text-gray-400">System Initializing...</p>
        </div>

        <!-- Purification Station Upgrade -->
        <div class="p-4 rounded-xl border-2 border-fuchsia-500 bg-black/30">
            <h3 class="text-xl font-bold mb-3 text-fuchsia-400 neon-glow-magenta">Purification Station (Aelia's Buff)</h3>
            <div class="flex justify-between items-center mb-4">
                <p class="text-lg text-gray-300">Current Rate:</p>
                <span id="rate-display" class="text-xl text-fuchsia-400">1.0 CM/s</span>
            </div>

            <button id="upgrade-btn" class="btn-base btn-upgrade w-full py-3 rounded-lg text-lg font-bold bg-fuchsia-700 text-white neon-glow-magenta hover:bg-fuchsia-600 disabled:opacity-30">
                Upgrade Purification (+1 CM/s)
            </button>
            <p id="cost-display" class="text-center mt-2 text-sm text-gray-400">Cost: 100 CM</p>
        </div>
    </div>

    <script>
        // --- Core Game Variables ---
        let corruptedMaterials = 0; // MCM
        let craftingMaterials = 0;    // CM (Used for upgrades/cross-promotion)
        
        let cmPerSecond = 1.0; // Base generation rate of CM
        let upgradeCost = 100;
        let upgradeFactor = 1.0; // CM/s to add per upgrade

        const TICK_RATE = 1000; // 1 second in milliseconds
        const PURIFY_BOOST_SECONDS = 10; // Boost effect: get 10 seconds worth of CM instantly

        // --- DOM Elements ---
        const mcmDisplay = document.getElementById('mcm-display');
        const cmDisplay = document.getElementById('cm-display');
        const rateDisplay = document.getElementById('rate-display');
        const costDisplay = document.getElementById('cost-display');
        const purifyBtn = document.getElementById('purify-btn');
        const upgradeBtn = document.getElementById('upgrade-btn');
        const purifyStatus = document.getElementById('purify-status');

        // --- Utility Functions ---

        /**
         * Updates the UI elements with current game state values.
         */
        function updateUI() {
            // Display values formatted to 1 decimal place or integer
            mcmDisplay.textContent = Math.floor(corruptedMaterials).toLocaleString();
            cmDisplay.textContent = Math.floor(craftingMaterials).toLocaleString();
            rateDisplay.textContent = cmPerSecond.toFixed(1) + " CM/s";
            costDisplay.textContent = `Cost: ${Math.floor(upgradeCost).toLocaleString()} CM`;
            
            // Check button state
            const canAfford = craftingMaterials >= upgradeCost;
            upgradeBtn.disabled = !canAfford;
            upgradeBtn.textContent = `Upgrade Purification (+${upgradeFactor.toFixed(1)} CM/s)`;
            
            // Re-enable clicker after initialization
            if (!purifyBtn.disabled) {
                purifyStatus.textContent = "Click to boost purification!";
            }
        }

        /**
         * Saves game state to local storage.
         */
        function saveGame() {
            try {
                const gameState = {
                    mcm: corruptedMaterials,
                    cm: craftingMaterials,
                    rate: cmPerSecond,
                    cost: upgradeCost,
                    factor: upgradeFactor
                };
                localStorage.setItem('glyphbound_inventory_save', JSON.stringify(gameState));
            } catch (e) {
                console.error("Could not save game to localStorage:", e);
            }
        }

        /**
         * Loads game state from local storage.
         */
        function loadGame() {
            try {
                const savedState = localStorage.getItem('glyphbound_inventory_save');
                if (savedState) {
                    const gameState = JSON.parse(savedState);
                    corruptedMaterials = gameState.mcm || 0;
                    craftingMaterials = gameState.cm || 0;
                    cmPerSecond = gameState.rate || 1.0;
                    upgradeCost = gameState.cost || 100;
                    upgradeFactor = gameState.factor || 1.0;
                    console.log("Game loaded successfully.");
                }
            } catch (e) {
                console.error("Could not load game from localStorage:", e);
            }
        }

        // --- Game Logic ---

        /**
         * The core game tick: calculates passive income.
         */
        function gameTick() {
            // Time elapsed per tick is TICK_RATE / 1000 seconds
            const secondsElapsed = TICK_RATE / 1000;
            
            // CM Generation (Primary Loop Goal)
            const cmGained = cmPerSecond * secondsElapsed;
            craftingMaterials += cmGained;

            // MCM Generation (Secondary Resource)
            // MCM is generally just a visual display of work being done, let's tie it to CM generation
            corruptedMaterials += cmGained * 5; // Generate 5 MCM for every 1 CM

            updateUI();
            saveGame();
        }

        /**
         * Handles the main clicker mechanic (Tap to Purify).
         */
        function handlePurifyClick() {
            // Get 10 seconds worth of passive production instantly
            const instantCM = cmPerSecond * PURIFY_BOOST_SECONDS;
            craftingMaterials += instantCM;

            purifyStatus.textContent = `+${instantCM.toFixed(1)} CM Instantly! Keep tapping!`;
            
            updateUI();
            saveGame();
        }

        /**
         * Handles the upgrade button click.
         */
        function handleUpgradeClick() {
            if (craftingMaterials >= upgradeCost) {
                // Deduct cost
                craftingMaterials -= upgradeCost;
                
                // Apply upgrade
                cmPerSecond += upgradeFactor;
                
                // Increase next cost (exponential growth model)
                upgradeCost = Math.floor(upgradeCost * 1.5);
                
                // Increase the benefit of the next upgrade (to keep it meaningful)
                upgradeFactor += 0.5;

                updateUI();
                saveGame();
            } else {
                // Custom modal/message box instead of alert()
                console.warn("Insufficient Crafting Materials to perform upgrade.");
                // Provide visual feedback (e.g., button shake or temporary color change)
                upgradeBtn.classList.add('animate-pulse', 'bg-red-500');
                setTimeout(() => {
                    upgradeBtn.classList.remove('animate-pulse', 'bg-red-500');
                }, 500);
            }
        }

        // --- Initialization and Event Listeners ---

        /**
         * The entry point for the game.
         */
        function initGame() {
            // 1. Load data
            loadGame();

            // 2. Attach listeners
            purifyBtn.addEventListener('click', handlePurifyClick);
            upgradeBtn.addEventListener('click', handleUpgradeClick);
            
            // 3. Start the game loop (The heart of the idle game)
            setInterval(gameTick, TICK_RATE);

            // 4. Initial UI update
            updateUI();
            purifyBtn.disabled = false; // Enable the clicker button
            purifyStatus.textContent = "Ready for input. Click to boost purification!";
        }

        // Start the game once the window is fully loaded
        window.onload = initGame;
    </script>
</body>
</html>
